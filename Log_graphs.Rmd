---
title: "log graphs for each county"
author: "Cheyenne Ehman"
date: "4/7/2021"
output: pdf_document
---

```{r, message = FALSE, warning = FALSE}
library(readxl)
library(tidyverse)
# read in OHIO_CASES_DATA
cases <- read_excel("COVID_CASES_OH_CNTY_20210223_pop.xlsx")
# convert dates
cases$DATE <- as.Date(cases$DATE, "%m/%d/%Y")
# remove UNASSIGNED and OUT OF OH data
cases <- cases%>%
  filter( (COUNTY != 'UNASSIGNED') & (COUNTY !='OUT OF OH'))%>%
  mutate(FIPS = str_sub(UID,start = 4,end = 8))%>%
  select(COUNTY,FIPS,DATE,CNTY_LAT,CNTY_LONG,POPULATION,CUMCONFIRMED,CUMDEATHS,NEWDEATHS,NEWCONFIRMED)

```

# $Log(Death_t + 1)$ for each county

```{r}
log_deaths_county_df <- cases %>%
  arrange(desc(POPULATION))%>%
  group_by(COUNTY) %>%
  mutate(log_deaths = log(CUMDEATHS + 1))

# all counties in order of descending population
all_counties <- unique(log_deaths_county_df$COUNTY) 
```


```{r, results='asis', fig.width= 12,fig.height=14}
library(ggforce)
library(splines)
for(i in 1:10){
  p <- ggplot(log_deaths_county_df, aes(x = DATE, y = log_deaths)) + 
      geom_point() + 
      geom_smooth(method = "lm",formula = y ~ bs(x,3)) + 
      facet_wrap_paginate(~COUNTY, ncol = 3, nrow = 3, page = i)+ 
      theme_bw() + 
      labs(x = "Date", y = "Log( Cumulative Deaths + 1 )")
  print(p)
  cat("\n\n\\newpage\n")
}
```

